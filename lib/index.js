"use strict";function _classCallCheck(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}function _createClass(a,b,c){if(b)_defineProperties(a.prototype,b);if(c)_defineProperties(a,c);return a}const META_NAME="monetization";let PaymentPointerProtector=function(){function a(b){_classCallCheck(this,a);if(typeof b==="string"){this.paymentPointer=b}else{throw new TypeError(`Expected 'paymentPointer' to be a string but got ${typeof b}.`)}this.autoGenerated=false;this.guard=this.guard.bind(this);this.release=this.release.bind(this);this._startMetaObserver=this._startMetaObserver.bind(this);this.__onMetaMutated=this.__onMetaMutated.bind(this);this._stopMetaObserver=this._stopMetaObserver.bind(this);this._startHeadObserver=this._startHeadObserver.bind(this);this.__onHeadMutated=this.__onHeadMutated.bind(this);this._stopHeadObserver=this._stopHeadObserver.bind(this)}_createClass(a,[{key:"guard",value:function guard(){this._startMetaObserver();this._startHeadObserver()}},{key:"release",value:function release(){this._stopMetaObserver();this._stopHeadObserver()}},{key:"_startMetaObserver",value:function _startMetaObserver(){let a=document.querySelector(`meta[name=${META_NAME}]`);if(!a){a=document.createElement("meta");a.name=META_NAME;a.content=this.paymentPointer;document.head.appendChild(a);this.autoGenerated=true}this.metaObserver=new MutationObserver(this.__onMetaMutated);this.metaObserver.observe(a,{attributes:true})}},{key:"_stopMetaObserver",value:function _stopMetaObserver(){var a;if(typeof((a=this.metaObserver)===null||a===void 0?void 0:a.disconnect)==="function"){this.metaObserver.disconnect();if(this.autoGenerated){const a=document.querySelector(`meta[name=${META_NAME}]`);if(a){a.remove()}}}}},{key:"__onMetaMutated",value:function __onMetaMutated(a){for(const b of a){if(b.target.name!==META_NAME){b.target.name=META_NAME}if(b.target.content!==this.paymentPointer){b.target.content=this.paymentPointer}}}},{key:"_startHeadObserver",value:function _startHeadObserver(){this.headObserver=new MutationObserver(this.__onHeadMutated);this.headObserver.observe(document.head,{childList:true})}},{key:"_stopHeadObserver",value:function _stopHeadObserver(){var a;if(typeof((a=this.headObserver)===null||a===void 0?void 0:a.disconnect)==="function"){this.headObserver.disconnect()}}},{key:"__onHeadMutated",value:function __onHeadMutated(a){for(const b of a){for(const a of b.removedNodes){if(a.name===META_NAME&&a.content===this.paymentPointer){this._stopMetaObserver();this._startMetaObserver()}}for(const a of b.addedNodes){if(a.name===META_NAME&&a.content!==this.paymentPointer){document.head.removeChild(a)}}}}}]);return a}();module.exports=PaymentPointerProtector;